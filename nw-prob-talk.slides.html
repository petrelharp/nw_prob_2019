<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Peter Ralph">
  <title>Whole genomes and whole genealogies</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
  <style type="text/css">
  
  .reveal { font-size: 30px; }
  
  .reveal h1 { font-size: 1.5em; } 
  
  .reveal h2 { font-size: 1.2em; } 
  
  .reveal .slides { text-align: left; }
  
  .reveal .slides figure { text-align: center; }
  
  .centered p { text-align: center; }
  
  .caption p { font-size: 75%; }
  
  .greyed { color: #4444; }
  
  div.floatright { float: right; text-align: right; }
  
  .reveal figcaption { display: none; }
  
  .reveal img { border: none; }
  
  .reveal section img { border: none; }
  
  .MathJax_Display { margin: 0; }
  
  img.finger { vertical-align: text-top; }
  
  </style>
  <div style="display: none">
  \[
  \newcommand{\E}{\mathbb{E}}
  \renewcommand{\P}{\mathbb{P}}
  \DeclareMathOperator{\var}{var}
  \]
  </div>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Whole genomes and whole genealogies</h1>
  <p class="subtitle">progress and challenges with tree sequences</p>
  <p class="author">Peter Ralph</p>
  <p class="date">Northwest Probability // October 2019</p>
</section>

<section><section id="genomes-and-genealogies" class="title-slide slide level1"><h1>Genomes and genealogies</h1></section><section id="genomes" class="slide level2">
<h2>Genomes</h2>
<ul>
<li class="fragment">are very big (<span class="math inline">\(10^7\)</span>–<span class="math inline">\(10^{12}\)</span> nucleotides)</li>
<li class="fragment">encode the basic <em>mechanisms</em> of life</li>
<li class="fragment">reflect past <em>history</em> and <em>process</em></li>
</ul>
</section><section id="section" class="slide level2">
<h2></h2>
<p>Your two copies of the genome were inherited, noisily, from your two parents,</p>
<div class="fragment">
<p>and from your four grandparents,</p>
</div>
<div class="fragment">
<p>and your eight great-grandparents</p>
</div>
<div class="fragment">
<p>and your sixteen great-great-grandparents</p>
</div>
<div class="fragment">
<p>… see where this is going?</p>
</div>
</section><section id="genealogical-ancestors" class="slide level2">
<h2>Genealogical ancestors</h2>
<p>In a well-mixed population of size <span class="math inline">\(N\)</span>,</p>
<ul>
<li><p>A most recent common ancestor of <em>everyone</em> lived at <span class="math inline">\(\approx \log_2 N\)</span> generations ago.</p></li>
<li><p>For humans: <span class="math inline">\(\approx 500\)</span> years; but including geography and history, <span class="math inline">\(\approx\)</span> 2–3 thousand years (Chang ’99; Rohde, Olson &amp; Chang ’04)</p></li>
<li><p><em>Everyone</em> alive <span class="math inline">\(\approx 1.77 \log_2 N\)</span> generations ago is either an ancestor of everyone or has left behind no descendants. (Chang ’99)</p></li>
</ul>
</section><section id="meiosis-recombination" class="slide level2">
<h2>Meiosis &amp; Recombination</h2>
<div class="columns">
<div class="column" style="width:50%;">
<figure>
<img data-src="figs/recombination-cartoon-crop.png" alt="recombination" /><figcaption>recombination</figcaption>
</figure>
</div><div class="column" style="width:50%;">
<ul>
<li><p>You have two copies of each chromosome, one from each parent.</p></li>
<li><p>When you make a gamete, the copies <em>recombine</em>, at Poisson(<span class="math inline">\(\rho\)</span>) locations.</p></li>
<li><p><em>Mutations</em> appear at Poisson(<span class="math inline">\(\mu\)</span>) locations.</p></li>
</ul>
</div>
</div>
</section><section id="you-and-your-greatk-1-grand-parents" class="slide level2">
<h2>You and your great<span class="math inline">\({}^{k-1}\)</span>-grand parents</h2>
<p>The number of <span class="math inline">\(k^\text{th}\)</span> <em>genetic</em> ancestors grows <em>linearly</em> with <span class="math inline">\(k\)</span>.</p>
<div class="centered">
<p><img data-src="figs/gcbias/num_genetics_vs_genealogical_ancs.png" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section><section id="section-1" class="slide level2">
<h2></h2>
<div class="centered">
<p><img data-src="figs/gcbias/parents_grandparents.png" style="width:60.0%" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section><section id="section-2" class="slide level2">
<h2></h2>
<div class="centered">
<p><img data-src="figs/gcbias/male_line.png" style="width:60.0%" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section><section id="section-3" class="slide level2">
<h2></h2>
<div class="centered">
<p><img data-src="figs/gcbias/family_tree.png" style="width:60.0%" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section><section id="section-4" class="slide level2">
<h2></h2>
<div class="centered">
<p><img data-src="figs/gcbias/family_tree_w_trans.png" style="width:60.0%" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section><section id="section-5" class="slide level2">
<h2></h2>
<div class="centered">
<p><img data-src="figs/gcbias/family_tree_w_trans_2.png" style="width:60.0%" /></p>
</div>
<div class="caption">
<p>from <a href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">gcbias.org</a></p>
</div>
</section></section>
<section><section id="section-6" class="title-slide slide level1"><h1></h1></section><section id="section-7" class="slide level2">
<h2></h2>
<p>Everyone is related by a vast genealogical network.</p>
<div class="fragment">
<p>We get to observe <em>genomes</em>, noisily transmitted through it.</p>
</div>
<div class="fragment">
<p>What can we learn about its structure? history? biology?</p>
<!-- the ARG -->
</div>
</section></section>
<section><section id="the-coalescent-with-recombination" class="title-slide slide level1"><h1>The coalescent with recombination</h1></section><section id="section-8" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li><span class="greyed"> blocks <em>split</em> at rate proportional to length </span></li>
<li><span class="greyed"> overlapping pairs <em>coalesce</em> at rate 1 </span></li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.1.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-9" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li><span class="greyed"> overlapping pairs <em>coalesce</em> at rate 1 </span></li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.2.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-10" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.3.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-11" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.4.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-12" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.5.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-13" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li><span class="greyed"> add mutations at the end </span></li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.6.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-14" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>blocks labeled by who inherits from them</li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li>add mutations at the end</li>
</ul>
<div class="greyed">
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Griffiths &amp; Marjoram)</p>
</div>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.7.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="section-15" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>In a <em>randomly mating</em> population of size <span class="math inline">\(N\)</span>, ancestry of some chromosomes follows a <em>fragmentation-coalescence process</em>:</p>
<ul>
<li>ancestral blocks assort into <em>ancestors</em></li>
<li>blocks <em>split</em> at rate proportional to length</li>
<li>overlapping pairs <em>coalesce</em> at rate 1</li>
<li>add mutations at the end</li>
</ul>
<p>Result: the <em>Ancestral Recombination Graph</em>, or ARG. (Hudson; Griffiths &amp; Marjoram)</p>
</div><div class="column" style="width:50%;">
<div class="floatright">
<p><img data-src="figs/frag_coal/fragmentation_coalescence.7.png" style="width:80.0%" /></p>
</div>
</div>
</div>
</section><section id="simulation" class="slide level2">
<h2>Simulation</h2>
<p><a href="https://github.com/jeromekelleher/msprime"><code>msprime</code></a>: whole genomes with <span class="math inline">\(N \sim 10^5\)</span> in <span class="math inline">\(O(\text{minutes})\)</span></p>
<p>by <a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004842">Kelleher, Etheridge, &amp; McVean 2016</a></p>
<div class="floatright">
<p><img data-src="figs/msprime-time.png" style="width:65.0%" /> <img data-src="figs/jerome.jpeg" alt="jerome kelleher" style="width:30.0%" /></p>
<div class="caption">
<p>jerome kelleher</p>
</div>
</div>
</section></section>
<section><section id="forwards-simulation" class="title-slide slide level1"><h1>Forwards simulation</h1></section><section id="section-16" class="slide level2">
<h2></h2>
<p>Coalescent simulations are <em>much faster</em> than forwards-time, individual-based simulations</p>
<div class="fragment">
<p>because they don’t have to keep track of <em>everyone</em>, only the ancestors of your sample.</p>
</div>
<div class="fragment">
<p><strong>But:</strong> coalescent theory relies on a <em>duality</em> that is broken by natural selection or real geography.</p>
</div>
</section><section class="slide level2">

<p>To study evolution or understand populations across real geography, we need individual-based, forwards-time simulations.</p>
<div class="fragment">
<p>Then every individual needs to carry around her genotype (somehow). Even at neutral sites!</p>
</div>
<div class="fragment">
<p><strong>Bummer.</strong></p>
</div>
<div class="fragment">
<p><em>But wait…</em></p>
</div>
</section><section id="section-17" class="slide level2">
<h2></h2>
<p>If we <em>record</em> exactly how everyone is related to everyone to everyone else,</p>
<p>we can add the neutral mutations <em>after the simulation is over</em>.</p>
<div class="fragment">
<p>Since neutral mutations don’t affect demography,</p>
<p>this is <em>equivalent</em> to having kept track of them throughout.</p>
</div>
</section><section class="slide level2">

<p>This means recording the entire genetic history of <strong>everyone</strong> in the population, <strong>ever</strong>.</p>
<div class="fragment">
<p>It is <em>not</em> clear this is a good idea.</p>
<!-- explain tree sequences and why they are so efficient (5min) -->
</div>
</section></section>
<section><section id="the-tree-sequence" class="title-slide slide level1"><h1>The tree sequence</h1></section><section id="history-is-a-sequence-of-trees" class="slide level2">
<h2>History is a sequence of trees</h2>
<p>For a set of sampled chromosomes, at each position along the genome there is a genealogical tree that says how they are related.</p>
<div class="fragment">
<figure>
<img data-src="figs/ts_ex/sim_ts.anim.gif" alt="Trees along a chromosome" style="width:100.0%" /><figcaption>Trees along a chromosome</figcaption>
</figure>
</div>
</section><section class="slide level2">

<p>The <strong>succinct tree sequence</strong></p>
<div class="floatright">
<p>is a way to succinctly describe this, er, sequence of trees.</p>
</div>
</section><section class="slide level2">

<figure>
<img data-src="figs/ts_ex/tree_sequence_genotypes.png" alt="genotypes" /><figcaption>genotypes</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="figs/ts_ex/tree_sequence_genotype_and_tree.png" alt="genotypes and a tree" /><figcaption>genotypes and a tree</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="figs/ts_ex/tree_sequence_next_genotype_and_tree.png" alt="genotypes and the next tree" /><figcaption>genotypes and the next tree</figcaption>
</figure>
</section><section class="slide level2">

<p><a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004842">Kelleher, Etheridge, and McVean</a> introduced the <strong>tree sequence</strong> data structure for a fast coalescent simulator, <a href="https://github.com/jeromekelleher/msprime">msprime</a>. <em>(updated in Kelleher, Thornton, Ashander, and R.; 2018)</em></p>
<ul>
<li><p>stores sequence <em>and</em> genealogical data <strong>very</strong> efficiently</p></li>
<li><p>tree-based sequence storage closely related to haplotype-matching compression</p></li>
<li><p>python/C <a href="https://github.com/tskit-dev/tskit"><code>tskit</code></a> tools</p></li>
</ul>
<div class="floatright">
<figure>
<img data-src="figs/jerome.jpeg" alt="jerome kelleher" style="width:50.0%" /><figcaption>jerome kelleher</figcaption>
</figure>
<div class="caption">
<p>jerome kelleher</p>
</div>
</div>
</section><section id="file-sizes" class="slide level2">
<h2>File sizes</h2>
<div class="centered">
<figure>
<img data-src="figs/tsinfer_sizes.png" alt="file sizes" style="width:90.0%" /><figcaption>file sizes</figcaption>
</figure>
</div>
<div class="caption">
<p>100Mb chromosomes; from <a href="https://www.nature.com/articles/s41588-019-0483-y">Kelleher et al 2018, <em>Inferring whole-genome histories in large population datasets</em></a>, Nature Genetics</p>
</div>
<!-- Estimated sizes of files required to store the genetic variation data for a
simulated human-like chromosome (100 megabases) for up to 10 billion haploid
(5 billion diploid) samples. Simulations were run for 10 1 up to 10 7 haplotypes
using msprime [Kelleher et al., 2016], and the sizes of the resulting files plotted
(points). -->
</section><section id="example-three-samples-two-trees-two-variant-sites" class="slide level2">
<h2>Example: three samples; two trees; two variant sites</h2>
<figure>
<img data-src="example_tree_sequence.png" alt="Example tree sequence" /><figcaption>Example tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<p>Storing a tree sequence in the four tables - <em>nodes</em>, <em>edges</em>, <em>sites</em>, and <em>mutations</em> - is <em>succinct</em> (no redundancy).</p>
<div class="fragment">
<p>These are stored efficiently on disk with a bit more information (e.g., metadata).</p>
</div>
</section><section id="nodes-and-edges" class="slide level2">
<h2>Nodes and edges</h2>
<dl>
<dt>Edges</dt>
<dd><p>Who inherits from who; only <em>necessary</em> for coalescent events.</p>
<p>Records: interval (left, right); parent node; child node.</p>
</dd>
<dt>Nodes</dt>
<dd><p>The ancestors those happen in.</p>
<p>Records: time ago (of birth); ID (implicit).</p>
</dd>
</dl>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.0.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.1.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.2.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.3.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.4.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.5.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="nodes_edges_walkthrough/nodes_edges_walkthrough.6.png" alt="Building a tree sequence" /><figcaption>Building a tree sequence</figcaption>
</figure>
</section><section id="sites-and-mutations" class="slide level2">
<h2>Sites and mutations</h2>
<dl>
<dt>Mutations</dt>
<dd><p>When state changes along the tree.</p>
<p>Records: site it occured at; node it occurred in; derived state.</p>
</dd>
<dt>Sites</dt>
<dd><p>Where mutations fall on the genome.</p>
<p>Records: genomic position; ancestral (root) state; ID (implicit).</p>
</dd>
</dl>
</section><section class="slide level2">

<figure>
<img data-src="sites_muts_walkthrough/sites_muts_walkthrough.0.png" alt="Adding mutations" /><figcaption>Adding mutations</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="sites_muts_walkthrough/sites_muts_walkthrough.1.png" alt="Adding mutations" /><figcaption>Adding mutations</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="sites_muts_walkthrough/sites_muts_walkthrough.2.png" alt="Adding mutations" /><figcaption>Adding mutations</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="sites_muts_walkthrough/sites_muts_walkthrough.3.png" alt="Adding mutations" /><figcaption>Adding mutations</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="sites_muts_walkthrough/sites_muts_walkthrough.4.png" alt="Adding mutations" /><figcaption>Adding mutations</figcaption>
</figure>
</section><section id="how-efficient" class="slide level2">
<h2>How efficient?</h2>
<p>Consider a tree <span class="math inline">\(T\)</span> with total length <span class="math inline">\(|T|\)</span>, that extends for distance <span class="math inline">\(W\)</span> along the genome.</p>
<ul>
<li class="fragment">The number of mutations on <span class="math inline">\(T\)</span> is <span class="math inline">\(\propto \mu W |T|\)</span>.</li>
<li class="fragment"><span class="math inline">\(\E[W] = \rho |T|\)</span>.</li>
<li class="fragment">Most adjacent trees differ by <span class="math inline">\(\approx\)</span> 4 edges.</li>
</ul>
<div class="fragment">
<p>So, the number of required entries should be <span class="math display">\[
    O\left((\rho + \mu) |T|\right) .
\]</span></p>
</div>
</section><section id="mean-area-of-a-tree" class="slide level2">
<h2>Mean area of a tree?</h2>
<ul>
<li class="fragment"><p>In a neutral, randomly mating population of size <span class="math inline">\(N\)</span>, the mean time with <span class="math inline">\(k\)</span> lineages is <span class="math inline">\(4N / (k (k-1))\)</span>.</p></li>
<li class="fragment"><p>So, for a tree with <span class="math inline">\(n\)</span> leaves, <span class="math display">\[
      \E[|T|] = \sum_{k=2}^n \frac{4N}{k-1} \approx 4N \log n .
  \]</span></p></li>
</ul>
<div class="fragment">
<p>Trees <em>and</em> genotypes of <span class="math inline">\(n\)</span> samples for a genome of length <span class="math inline">\(L\)</span> should be storable in <span class="math display">\[
        O\left( (\rho + \mu) L N \log n \right) .
    \]</span></p>
<!-- application to fwds sim recording (5min) -->
</div>
</section></section>
<section><section id="forwards-time-tree-sequence-recording" class="title-slide slide level1"><h1>Forwards-time tree sequence recording</h1></section><section id="tree-recording-strategy" class="slide level2">
<h2>Tree recording strategy</h2>
<p>Every time an individual is born, we must:</p>
<div>
<ol type="1">
<li class="fragment">add each gamete to the Node Table,</li>
<li class="fragment">add entries to the Edge Table recording which parent each gamete inherited each bit of genome from, and</li>
<li class="fragment">add any new selected mutations to the Mutation Table and (if necessary) their locations to the Site Table.</li>
</ol>
</div>
<div class="fragment">
<div class="columns">
<div class="column" style="width:15%;">
<figure>
<img data-src="finger_right.png" alt="Rightarrow" style="width:100.0%" /><figcaption>Rightarrow</figcaption>
</figure>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:75%;">
<p>This produces <strong>waaaaay</strong> too much data.</p>
</div>
</div>
</div>
</section><section class="slide level2">

<p>We won’t end up needing the <em>entire</em> history of <em>everyone ever</em>,</p>
<div class="fragment">
<p>but we won’t know <em>what</em> we’ll need until later.</p>
</div>
<div class="fragment">
<p>How do we get rid of the extra stuff?</p>
</div>
</section><section id="simplification" class="slide level2">
<h2>Simplification</h2>
<p><em>Question:</em> given a tree sequence containing the history of many individuals, how do we <em>simplify</em> it to only the history of a subset?</p>
</section><section class="slide level2">

<p>Given an input tree sequence and a subset of its nodes we call the <em>samples</em>,</p>
<p>we want a new tree sequence for which:</p>
<ol type="1">
<li><p>All marginal subtrees agree.</p></li>
<li><p>All non-sample nodes have at least two children in every tree.</p></li>
<li><p>All nodes and edges are ancestral to at least one sample.</p></li>
<li><p>No mergeable edges (e.g., <span class="math inline">\((\ell, x, p, c) + (x, r, p, c) \rightarrow (\ell, r, p, c)\)</span>).</p></li>
</ol>
</section><section class="slide level2">

<p><em>Answer:</em> to simplify a tree sequence to the history of the <em>samples</em>:</p>
<ol type="1">
<li><p>Paint each <em>sampled</em> chromosome a distinct color.</p></li>
<li><p>Moving back up the tree sequence, copy colors of each chromosome to the parental chromosomes they inherited from.</p></li>
<li><p>If two colors go in the same spot (<em>coalescence</em>), replace with a new color (unique to that ancestor). Output a node for the ancestor and an edge for the coalescence.</p></li>
<li><p>Once all colors have coalesced in a given segment, stop propagating it.</p></li>
</ol>
</section><section id="an-example-simplify-these-to-j-and-k" class="slide level2">
<h2>An example: simplify these to J and K</h2>
<figure>
<img data-src="simplify_walkthrough.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.0.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.1.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.2.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.3.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.4.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.5.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.6.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.7.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.8.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.9.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.10.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.11.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.12.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.13.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.14.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="simplify_walkthrough/simplify_walkthrough.15.png" alt="Simplify example" style="width:100.0%" /><figcaption>Simplify example</figcaption>
</figure>
</section><section id="wright-fisher-n10-before-simplification" class="slide level2">
<h2>Wright-Fisher, N=10: before simplification</h2>
<figure>
<img data-src="sim_wf.anim.gif" alt="Wright-Fisher tree sequence" /><figcaption>Wright-Fisher tree sequence</figcaption>
</figure>
</section><section id="wright-fisher-n10-before-simplification-1" class="slide level2">
<h2>Wright-Fisher, N=10: before simplification</h2>
<figure>
<img data-src="sim_wf_unlabeled.anim.gif" alt="Wright-Fisher tree sequence" /><figcaption>Wright-Fisher tree sequence</figcaption>
</figure>
</section><section id="and-after-simplification" class="slide level2">
<h2>… and after simplification</h2>
<figure>
<img data-src="sim_wf_simplified.anim.gif" alt="Simplified Wright-Fisher tree sequence" /><figcaption>Simplified Wright-Fisher tree sequence</figcaption>
</figure>
</section><section id="revised-tree-recording-strategy" class="slide level2">
<h2><em>Revised</em> tree recording strategy</h2>
<p>Every time an individual is born, we must:</p>
<ol type="1">
<li>add each gamete to the Node Table,</li>
<li>add entries to the Edge Table recording which parent each gamete inherited each bit of genome from</li>
<li>add any new mutations to the Mutation Table and (if necessary) their locations to the Site Table.</li>
</ol>
<p>… and,</p>
<ol start="4" type="1">
<li>Every so often, <em>simplify</em> the tables so far, retaining the history of the current generation.</li>
</ol>
</section><section id="implementation" class="slide level2">
<h2>Implementation</h2>
<div class="centered">
<p><img data-src="figs/slim_logo.png" style="width:65.0%" /></p>
</div>
<div class="floatright caption">
<p>Kelleher, Thornton, Ashander, and R. (2018)</p>
<p>Haller, Galloway, Kelleher, Messer &amp; R. (2018)</p>
</div>
</section><section id="it-works" class="slide level2">
<h2>It works!</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img data-src="figs/slim_speedup.png" style="width:100.0%" /></p>
</div><div class="column" style="width:40%;">
<div class="caption">
<p><strong>SLiM:</strong> forwards-time, individual-based, with selection on whole genomes, continuous geography, etcetera. (Haller &amp; Messer).</p>
<p>Note: with “treeSeq”, the neutral mutation rate was <em>zero</em> but neutral mutations were added <em>afterwards</em>.</p>
</div>
</div>
</div>
<!--
## Simulation parameters

1. Wright-Fisher population of size $N$
2. simulated for $10N$ genreations
3. neutral mutation rate $\mu$ equal to recombination rate $r$ per gamete
4. many, weakly deleterious mutations: rate $\mu/100$ with
    $s$ exponentially distributed with mean $2.5/N$.



--------------------------

![Total run time per single simulation as a function of region length.](rawspeed.png){ width=80% }

--------------------------

![Relative speedup of simulations](speedup.png){ width=80% }

-->
</section></section>
<section><section id="summarizing-genomes-and-genealogies" class="title-slide slide level1"><h1>Summarizing genomes and genealogies</h1></section><section id="fast-genotype-statistics" class="slide level2">
<h2>Fast genotype statistics</h2>
<div class="centered">
<figure>
<img data-src="figs/treestats/benchmarks_without_copy_longer_genome.png" alt="efficiency of treestat computation" style="width:70.0%" /><figcaption>efficiency of treestat computation</figcaption>
</figure>
</div>
<div class="caption">
<p>from <a href="https://www.biorxiv.org/content/10.1101/779132v1?rss=1">R., Thornton and Kelleher 2019, <em>Efficiently summarizing relationships in large samples</em></a>, bioRxiv</p>
</div>
</section><section id="section-18" class="slide level2">
<h2></h2>
<p><strong>What do genotypes tell us about the genealogies?</strong></p>
<div class="caption">
<p>from <a href="https://www.biorxiv.org/content/10.1101/779132v1?rss=1">R., Thornton and Kelleher 2019, <em>Efficiently summarizing relationships in large samples</em></a>, bioRxiv</p>
</div>
</section><section id="summaries-of-genotypes-and-genealogies" class="slide level2">
<h2>Summaries of genotypes and genealogies</h2>
<div class="columns">
<div class="column" style="width:47%;">
<p><em>Genotypes:</em></p>
<ol type="1">
<li>For each site,</li>
<li>look at who has which alleles,</li>
<li>and add a <em>summary</em> of these values to our running total.</li>
</ol>
<p><em>Example:</em> genetic distance counts how many mutations differ between two sequences.</p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:47%;">
<!-- nothing til next slide -->
</div>
</div>
</section><section id="summaries-of-genotypes-and-genealogies-1" class="slide level2">
<h2>Summaries of genotypes and genealogies</h2>
<div class="columns">
<div class="column" style="width:47%;">
<p><em>Genotypes:</em></p>
<ol type="1">
<li>For each site,</li>
<li>look at who has inherited which alleles,</li>
<li>and add a <em>summary</em> of these values to the running total.</li>
</ol>
<p><em>Example:</em> sequence divergence counts how many mutations differ between two sequences.</p>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:47%;">
<p><em>Trees:</em></p>
<ol type="1">
<li>For each branch,</li>
<li>look at who would inherit mutations on that branch,</li>
<li>and add the <em>expected contribution</em> to the running total.</li>
</ol>
<p><em>Example:</em> the mean time to most recent common ancestor between two sequences.</p>
</div>
</div>
</section><section id="section-19" class="slide level2">
<h2></h2>
<figure>
<img data-src="figs/ts_ex/tree_sequence_site_and_branch.png" alt="site and branch stats" /><figcaption>site and branch stats</figcaption>
</figure>
</section><section id="section-20" class="slide level2">
<h2></h2>
<p>Given</p>
<ol type="1">
<li>a <em>weight</em> <span class="math inline">\(w_i \in \mathbb{R}^n\)</span> to each <em>sample node</em>, and</li>
<li>a <em>summary function</em> <span class="math inline">\(f : \mathbb{R}^n \to \mathbb{R}\)</span>,</li>
</ol>
<div class="fragment">
<p>the <strong>Site</strong> statistic <span class="math display">\[\begin{equation}
 \text{Site}(f,w) = \sum_{i: \text{sites}} \sum_{a: \text{alleles}_i} f(w_a)
\end{equation}\]</span> is the total summarized weights of all <em>alleles</em> at all sites,</p>
</div>
<div class="fragment">
<p>and the <strong>Branch</strong> statistic <span class="math display">\[\begin{equation}
 \text{Branch}(f,w) = \sum_{T: \text{trees}} s_T \sum_{b: \text{branches}_T} f(w_b) \ell_b
\end{equation}\]</span> is the <em>expected value</em> of <span class="math inline">\(\text{Site}(f,w)\)</span> under Poisson(1) mutation, given the trees.</p>
</div>
</section><section id="duality" class="slide level2">
<h2>Duality</h2>
<p>Any set of <em>sample weights</em> <span class="math inline">\(w\)</span> and <em>summary function</em> <span class="math inline">\(f\)</span> defines both</p>
<ul>
<li>a statistic of genotypes, <span class="math inline">\(\text{Site}(f,w)\)</span>, and</li>
<li>a statistic of genealogies, <span class="math inline">\(\text{Branch}(f,w)\)</span>.</li>
</ul>
<div class="fragment">
<p>With genealogies <em>fixed</em>, and averaging only over <em>mutations</em> with rate <span class="math inline">\(\mu\)</span>, <span class="math display">\[\begin{equation}
    \text{Branch}(f, w) = \frac{1}{\mu} \E\left[ \text{Site}(f, w) \right] .
\end{equation}\]</span></p>
</div>
<div class="fragment">
<p>Dealing directly with genealogies can <em>remove the layer of noise due to mutation</em>: <span class="math display">\[\begin{equation}
    \frac{1}{\mu^2} \var\left[\text{Site}(f,w)\right]
    =
    \var\left[\text{Branch}(f,w)\right]
    +
    \frac{1}{n}
    \E\left[\text{Branch}(f^2,w)\right]
\end{equation}\]</span></p>
<div class="caption greyed floatright">
<p>also see R., TPB, 2019</p>
</div>
</div>
</section><section id="section-21" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column" style="width:60%;">
<figure>
<img data-src="figs/treestats/relate_chr20_site_div_branch.1000000.diversity.png" alt="duality in 1000G data" style="width:100.0%" /><figcaption>duality in 1000G data</figcaption>
</figure>
</div><div class="column" style="width:40%;">
<p>Duality, on 1000 Genomes data? Not quite…</p>
<ul>
<li>variation in mutation rate?</li>
<li>biased gene conversion?</li>
<li>selection?</li>
<li>inference artifacts?</li>
</ul>
<div class="caption">
<p><em>Tree sequence from <a href="https://www.nature.com/articles/s41588-019-0484-x">Speidel et al 2019</a>.</em></p>
</div>
</div>
</div>
</section></section>
<section><section id="inferring-the-tree-sequence" class="title-slide slide level1"><h1>Inferring the tree sequence</h1></section><section id="section-22" class="slide level2">
<h2></h2>
<p>What about real data?</p>
<div class="fragment">
<p><em>Back-of-the-envelope:</em> One million whole human genomes should be related by around 35 million trees.</p>
</div>
</section><section id="inferring-the-ancestry-of-everyone" class="slide level2">
<h2>Inferring the ancestry of everyone</h2>
<p>Previous methods: ARGweaver, Rent+, fastARG</p>
<div class="fragment">
<p><strong>Left-to-right:</strong></p>
<p><strong>Relate:</strong> Leo Speidel, Marie Forest, Sinan Shi, and Simon Myers. <a href="https://www.nature.com/articles/s41588-019-0484-x"><em>A method for genome-wide genealogy estimation for thousands of samples.</em></a> Nature Genetics, 51(9):1321–1329, 2019.</p>
</div>
<div class="fragment">
<p><strong>Bottom-up:</strong></p>
<p><strong>tsinfer:</strong> Jerome Kelleher, Yan Wong, Anthony Wohns, Chaimaa Fadil, Patrick Albers, and Gil McVean. <a href="https://www.nature.com/articles/s41588-019-0483-y"><em>Inferring whole-genome histories in large population datasets.</em></a> Nature Genetics, 51(9):1330–1338, 2019.</p>
</div>
</section><section id="tsinfer-kelleher-et-al" class="slide level2">
<h2><code>tsinfer</code> (Kelleher et al)</h2>
<figure>
<img data-src="figs/tsinfer_method.png" alt="Fig. 2 from tsinfer" /><figcaption>Fig. 2 from tsinfer</figcaption>
</figure>
</section><section id="challenges-in-inference" class="slide level2">
<h2>Challenges in inference</h2>
<ul>
<li>segmentation of genomes into <em>shared haplotypes</em></li>
<li>hierarchical structuring into a <em>tree sequence</em></li>
<li>calibration of <em>node times</em></li>
<li>estimating <em>uncertainty</em></li>
</ul>
</section><section id="li-stephens" class="slide level2">
<h2>Li &amp; Stephens</h2>
<figure>
<img data-src="figs/speidel-li-and-stephens.png" alt="Supp Fig 1 from Speidel et al" /><figcaption>Supp Fig 1 from Speidel et al</figcaption>
</figure>
<div class="caption floatright">
<p>from Speidel et al</p>
</div>
</section><section id="what-can-you-do-with-the-tree-sequence" class="slide level2">
<h2>What can you do with the tree sequence?</h2>
<figure>
<img data-src="figs/speidel-et-al_results-tree.png" alt="Fig 4 from Speidel et al" /><figcaption>Fig 4 from Speidel et al</figcaption>
</figure>
<div class="caption floatright">
<p>from Speidel et al</p>
</div>
</section><section id="what-can-you-do-with-the-tree-sequence-1" class="slide level2">
<h2>What can you do with the tree sequence?</h2>
<figure>
<img data-src="figs/speidel-et-al_results-mutrate.png" alt="Fig 4 from Speidel et al" /><figcaption>Fig 4 from Speidel et al</figcaption>
</figure>
<div class="caption floatright">
<p>from Speidel et al; also see Harris (2015)</p>
</div>
</section><section id="how-to-compare-tree-sequences" class="slide level2">
<h2>How to compare tree sequences?</h2>
<figure>
<img data-src="figs/tsinfer_kc_metric.png" alt="Fig 3 from tsinfer" style="width:90.0%" /><figcaption>Fig 3 from tsinfer</figcaption>
</figure>
<div class="caption floatright">
<p>KC = average Kendall-Colijn tree metric; from Kelleher et al</p>
</div>
</section><section id="open-question" class="slide level2">
<h2>Open question</h2>
<p>Define a metric on tree sequences that:</p>
<ul>
<li>measures both similarity of marginal trees</li>
<li><em>and</em> haplotype structure,</li>
<li>and is efficiently calculable.</li>
</ul>
</section></section>
<section><section id="wrap-up" class="title-slide slide level1"><h1>Wrap-up</h1></section><section id="section-23" class="slide level2">
<h2></h2>
<p><em>Tree sequences</em> are a very nice data structure for genomes that derive from the <em>generative (genealogical) process</em>.</p>
<div class="fragment">
<p>Lots to do on</p>
<ul>
<li>theoretical properties from generative processes,</li>
<li>summaries and descriptive statistics,</li>
<li>defining metrics, and</li>
<li><strong>inference</strong>!</li>
</ul>
</div>
</section><section id="code-availability" class="slide level2">
<h2>Code availability</h2>
<div class="columns">
<div class="column">
<p>Everything is efficient, open, and tested:</p>
<ul>
<li><p><code>tskit</code>: tree sequence tools</p>
<p><a href="https://github.com/tskit-dev/tskit">github:tskit-dev/tskit</a></p></li>
<li><p><code>msprime</code>: coalescent simulator,</p>
<p><a href="https://github.com/tskit-dev/msprime">github:tskit-dev/msprime</a></p></li>
<li><p><code>SLiM</code> : forwards evolutionary simulator</p>
<p><a href="https://messerlab.org/slim/">messerlab.org/slim</a></p></li>
</ul>
</div><div class="column">
<figure>
<img data-src="figs/tskit_logo_pale.png" alt="tskit logo" style="width:100.0%" /><figcaption>tskit logo</figcaption>
</figure>
</div>
</div>
</section><section id="thanks" class="slide level2">
<h2>Thanks</h2>
<div class="columns">
<div class="column">
<ul>
<li>Philipp Messer</li>
<li>Boyana Norris</li>
<li>Gil McVean</li>
<li>Georgia Tsambos</li>
<li>Yan Wong</li>
<li>Simon Myers</li>
<li>Wilder Wohns</li>
<li>Kevin Thornton</li>
<li>Graham Coop</li>
<li>Gideon Bradburd</li>
<li>Alison Etheridge</li>
<li>CJ Battey</li>
<li>Andy Kern</li>
</ul>
</div><div class="column">
<ul>
<li><code>tskit-dev</code></li>
<li>Jerome Kelleher</li>
<li>Ben Haller</li>
<li>Jared Galloway</li>
<li>Jaime Ashander</li>
</ul>
<p>Funding: NSF, UO (PR); Wellcome Trust (JK);</p>
<p>Slides with <a href="http://hakim.se">reveal.js</a> and <a href="https://pandoc.org/">pandoc</a>.</p>
<figure>
<img data-src="figs/tskit_logo_pale.png" alt="tskit logo" style="width:50.0%" /><figcaption>tskit logo</figcaption>
</figure>
</div>
</div>
<!-- questions?? -->
</section><section id="section-24" class="slide level2" data-background-image="figs/guillemots_thanks.png" data-background-position="center" data-background-size="50%">
<h2></h2>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/math/math.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
